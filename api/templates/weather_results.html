{% extends 'base.html' %}
{% block title %}Været i {{place.split("_")[0]}}{% endblock %} 
{% block content%}
    <h1>Været i {{ place.split("_")[0] }}</h1>
    <p>{{ ", ".join(place.split("_")[1:]) }}</p>
    <p>Klikk for å se time for time</p>
    <p id="section_count" style="display: none;">{{ section_count }}</p>
    <div class="weather_table_overview">
        {% for day in days %}
        <div class="weather_box" id="day_{{day.section_index}}">
           
                <h1>
                    {{day.weekday}} 
                </h1>
                <h3>
                    {{day.date}} 
                </h3>
               
                {% set svg_filename = day.icon + ".svg" %}
                <div class="container">
                    <img src="{{ url_for('static', filename='icons/' + svg_filename) }}" alt="">
                    <h2>
                        {{ day.max }}° / {{ day.min }}°
                    </h2>
                </div>
            
 

        </div>

        {% endfor %} 
    </div>
    </table>
 
    <div class="weather_content">
        
        <p id="time_for_time">Time for time</p>
       
        <table class="weather_table">
            <colgroup>
               
                <col style="width: 30%;">
                <col style="width: 15%;">
                <col style="width: 20%;">
                <col style="width: 15%;">
              
                <!-- Add more columns as needed -->
            </colgroup>
                <tr>
                    <th>Når</th>
                    <th>Vær</th>
                    <th>Temperatur</th>
                    <th>Nedbør</th>
                    <th>Vind</th>
                </tr>
            {% for section in separated_hours %}
        
                {% for hour in section.hours %}
                   
                        <tr class="section_{{section.index}}" style="display: none;">
                            <td style="display: none;">{{ hour.day }}</td>
                            <td>
                    
                                {{ hour.time }}
                            </td>
                            <td>
                           
                                    {% set svg_filename = hour.data.next_1_hours.summary.symbol_code + ".svg" %}
                                    <img width="48" height="48" src="{{ url_for('static', filename='icons/' + svg_filename) }}" alt="">
                           
                                
                            </td>
                            <td>
                                {{ hour.data.instant.details.air_temperature }}°
                            </td>
                            
                        
                    
                            <td style="color: rgb(0, 0, 150)">
                                {% if hour.data.next_1_hours  %}
                                {{ hour.data.next_1_hours.details.precipitation_amount }}mm
                                {%endif%}
                            
                            </td>
                            <td>
                                {{ hour.data.instant.details.wind_speed }}m/s 
                                <div class="arrow" style="transform: rotate({{ hour.data.instant.details.wind_from_direction }}deg); display: inline-block">
                                <div class="arrow" style="transform: rotate({{ hour.data.instant.details.wind_from_direction }}deg); inline-block;">
                                    <b>&DownArrow;</b>
                                </div>
                            </td>
                        </tr>
                    
                {% endfor %} 
            {% endfor %} 
        </table>
        
 
    </div>

    <script>
        const sectionCount = parseInt(document.querySelector("#section_count").innerHTML);
        const timeForTime = document.querySelector("#time_for_time");
        const table = document.querySelector(".weather_table")

        

        let sections = []
        let dayButtons = []

        for (let i = 0; i < sectionCount; i++) {
            let dayButton = document.querySelector("#day_" + i);
            dayButtons.push(dayButton);
            let rows = document.querySelectorAll(".section_" + i) 
        
            sections.push(rows)
        } 

        sections[0].forEach(row => {
            row.style.display = "table-row"
            timeForTime.innerHTML = "I dag, " + row.firstElementChild.innerHTML.replace(",","")
        })

        dayButtons.forEach((button, buttonIndex) => {
            button.addEventListener('click',()=>{
                let updatedTfT = false
                sections.forEach(section => {
                    section.forEach(row => {
                        row.style.display = "none"
                    })
                   
                    sections.forEach((section, sectionIndex) => {
                     
                        
                        if (sectionIndex != buttonIndex) {
                            section.forEach(row => {
                                row.style.display = "none"
                            })  
                        }
                        else {
                            if (!updatedTfT) {
                                let day = section[0].firstElementChild.innerHTML
                                console.log(day)
                                let today = ""
                                if (buttonIndex == 0) {
                                    today = "I dag, "
                                }
                                timeForTime.innerHTML = today + day.replace(",","")
                                updatedTfT = true
                                table.classList.remove('update_table'); // Remove the class to reset the animation
                                
                                setTimeout(() => {
                                    table.classList.add('update_table'); // Re-add the class to start the animation again
                                }, 10);
                              
                            }
                      
                            section.forEach(row => {
                                
                                //timeForTime.innerHTML = row.firstChild.innerHTML.trim().split(",")[0];
                                row.style.display = "table-row"
                            })
                        }  
                    })
                })
            })
        })

        
        //     // if (expanded) expanded=false
        //     // else expanded = true

         

       

        //     current += 1;
        //     if (current > sectionCount) {
        //         current = 0;
        //     }

        //     // if (expanded) {
        //     //     tableRows.forEach(row=>{
        //     //         row.style.display = "table-row"
        //     //     })
        //     //     button.innerHTML = "Vis mindre"
        //     // } else {
        //     //     tableRows.forEach((row, index) => {
        //     //         if (index >= 4) {
        //     //             row.style.display = "none"
        //     //         }
        //     //     })
        //     //     button.innerHTML = "Vis mer"
        //     // }
        // })
    </script>

{% endblock %}
